# GPF Reboot - Target-Centric Prior Modeling Configuration with SVD
# Datasets : ['cora', 'citeseer', 'pubmed', 'computers', 'photo']
# Experiment Type & Cross-Domain Settings
experiment:
  type: "cross_domain"  # "single_domain" or "cross_domain"
  source_dataset: "citeseer"
  target_dataset: "photo"
  seed: 46
  device: auto
  log_level: INFO
  run_name: null  # auto-generated if null

# Dataset Configuration
dataset:
  # For single_domain experiments
  name: "cora"  # used when experiment.type == "single_domain"
  
  # Cross-domain split ratios
  split:
    val_ratio: 0.1
    test_ratio: 0.2
    shuffle: true
  
  # Data loading settings
  data_loading:
    cache_datasets: true  # cache loaded datasets

# SVD Feature Reduction (NEW!)
feature_reduction:
  enable: true
  method: "svd"  # currently only "svd" supported
  target_dim: 100  # all datasets reduced to 100D
  save_reducer: true  # save SVD parameters for reuse
  explained_variance_threshold: 0.95  # minimum variance to preserve

# Model Architecture
# model:
#   type: gin
#   hidden_dim: 128
#   num_layers: 5
#   dropout: 0.5

model:
  type: "gcnii"
  hidden_dim: 128
  num_layers: 5      # 깊게 설정 가능
  dropout: 0.5
  alpha: 0.2         # 적당한 initial feature 보존
  theta: 1.0         # 표준 identity mapping

# Pretraining (on source dataset with SVD)
pretrain:
  lr: 0.001
  weight_decay: 0.0005
  epochs: 1000
  
  # Contrastive learning settings
  augmentation:
    view1: dropN
    view2: permE
    aug_ratio: 0.2
    temperature: 0.5

# Prompt Tuning (on target dataset with SVD alignment)
prompt_tuning:
  lr: 0.01
  weight_decay: 0.0005
  epochs: 200
  early_stopping:
    enable: true
    patience: 30
    min_delta: 0.001

# Prompt Configuration
prompt:
  type: "linear"  # "gpf", "residual_mlp", "linear"
  
  # GPFPrompt parameters (when type: "gpf")
  gpf:
    num_prompts: 10
  
  # ResidualMLPPrompt parameters (when type: "residual_mlp")
  residual_mlp:
    hidden_dim: 64
    num_layers: 2
    dropout: 0.1
  
  # LinearPrompt parameters (when type: "linear")
  linear:
    out_channels: null  # null means same as input_dim (in_channels)

# Target-Centric Prior Modeling (Static Methods - Legacy)
target_centric:
  enable: false  # Disabled when dynamic_anchor is enabled
  regularization:
    weight: 0.1
    anchor:
      type: "mog"
      num_components: 8      # Gaussian component 수
      num_anchors: 1000       # 총 anchor 수
      use_sklearn_gmm: true  # true면 full GMM, false면 simplified
    mapper:
      type: "identity"       # MoG는 이미 latent space에서 생성
    divergence:
      type: "mmd"
      params:
        sigma: 0.25

# Dynamic Performance-Based Anchor Selection (Primary Method)
dynamic_anchor:
  enable: true
  selection_ratio: 0.3          # Top 30% performing nodes as anchors
  update_frequency: 10          # Update anchors every 10 epochs
  soft_update_momentum: 0.9     # Momentum for soft anchor updates (0=hard, 1=no update)
  
  # Performance criteria for anchor selection
  criteria:
    loss_weight: 1.0           # Weight for individual node loss (primary criterion)
    confidence_weight: 0.0     # Weight for prediction confidence (secondary criterion)
  
  # Quality tracking and monitoring
  quality_tracking: true       # Enable anchor quality metrics tracking
  
  # Fallback mechanism for robustness
  fallback:
    enable: true
    method: "mog"             # Fallback to MoG anchors if dynamic selection fails
    conditions:
      performance_drop: 0.05   # Trigger fallback if accuracy drops > 5%
      anchor_diversity: 0.3    # Minimum diversity threshold for anchors
      selection_instability: 0.5  # Minimum overlap ratio between consecutive selections

# Legacy anchor methods (available but deprecated)
mog_anchor:
  enable: false               # Automatically disabled when dynamic_anchor is enabled
  num_components: 8
  num_anchors: 1000

static_anchor:
  enable: false               # Legacy static anchor selection
  
# Regularization settings (shared between methods)
regularization:
  weight: 0.1                 # Overall regularization strength (beta)
  divergence:
    type: "mmd"               # Distance metric: "mmd" or "wasserstein"
    params:
      sigma: 0.25             # MMD kernel bandwidth

# Evaluation & Logging
evaluation:
  metrics: ["accuracy", "f1_macro", "f1_micro"]
  save_results: true
  results_dir: "results"
  
# Reproducibility
reproducibility:
  deterministic: true
  benchmark: false